"use strict";(()=>{var M,R,b,P;function y(e,n=!1){return window.__TAURI_INTERNALS__.transformCallback(e,n)}M=new WeakMap,R=new WeakMap,b=new WeakMap;async function o(e,n={},t){return window.__TAURI_INTERNALS__.invoke(e,n,t)}P=new WeakMap;var w;(function(e){e.WINDOW_RESIZED="tauri://resize",e.WINDOW_MOVED="tauri://move",e.WINDOW_CLOSE_REQUESTED="tauri://close-requested",e.WINDOW_DESTROYED="tauri://destroyed",e.WINDOW_FOCUS="tauri://focus",e.WINDOW_BLUR="tauri://blur",e.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",e.WINDOW_THEME_CHANGED="tauri://theme-changed",e.WINDOW_CREATED="tauri://window-created",e.WEBVIEW_CREATED="tauri://webview-created",e.DRAG_ENTER="tauri://drag-enter",e.DRAG_OVER="tauri://drag-over",e.DRAG_DROP="tauri://drag-drop",e.DRAG_LEAVE="tauri://drag-leave"})(w||(w={}));async function v(e,n){await o("plugin:event|unlisten",{event:e,eventId:n})}async function _(e,n,t){var s;let r=typeof t?.target=="string"?{kind:"AnyLabel",label:t.target}:(s=t?.target)!==null&&s!==void 0?s:{kind:"Any"};return o("plugin:event|listen",{event:e,target:r,handler:y(n)}).then(u=>async()=>v(e,u))}async function A(e,n,t){return _(e,s=>{v(e,s.id),n(s)},t)}async function T(e,n){await o("plugin:event|emit",{event:e,payload:n})}var l={async openInput(e){try{return{status:"ok",data:await o("plugin:midi|open_input",{id:e})}}catch(n){if(n instanceof Error)throw n;return{status:"error",error:n}}},async closeInput(e){await o("plugin:midi|close_input",{id:e})},async openOutput(e){try{return{status:"ok",data:await o("plugin:midi|open_output",{id:e})}}catch(n){if(n instanceof Error)throw n;return{status:"error",error:n}}},async closeOutput(e){await o("plugin:midi|close_output",{id:e})},async outputSend(e,n){try{return{status:"ok",data:await o("plugin:midi|output_send",{id:e,msg:n})}}catch(t){if(t instanceof Error)throw t;return{status:"error",error:t}}}},g=W({midiMessage:"plugin:midi:midi-message",stateChange:"plugin:midi:state-change"});function W(e){return new Proxy({},{get:(n,t)=>{let s=e[t];return new Proxy(()=>{},{apply:(r,u,[a])=>({listen:i=>a.listen(s,i),once:i=>a.once(s,i),emit:i=>a.emit(s,i)}),get:(r,u)=>{switch(u){case"listen":return a=>_(s,a);case"once":return a=>A(s,a);case"emit":return a=>T(s,a)}}})}})}var m=class extends EventTarget{constructor(t){super();this.sysexEnabled=!0;this.inputs=new Map;this.outputs=new Map;this.onstatechange=null;g.stateChange.listen(s=>{let{inputs:r,outputs:u}=s.payload,a=!1;for(let[i,p]of this.inputs)r.find(([c,D])=>c===i)||(this.inputs.delete(i),p.state="disconnected",a=!0);for(let[i,p]of this.outputs)u.find(([c,D])=>c===i)||(this.outputs.delete(i),p.state="disconnected",a=!0);for(let[i,p]of r){if(this.inputs.has(i))continue;let c=new E(i,p);c.state="connected",this.inputs.set(i,c),a=!0}for(let[i,p]of u){if(this.outputs.has(i))continue;let c=new f(i,p);c.state="connected",this.outputs.set(i,c),a=!0}a&&this.dispatchEvent(new Event("statechange")),t()})}addEventListener(t,s,r){super.addEventListener(t,s,r)}removeEventListener(t,s,r){super.removeEventListener(t,s,r)}},h=class extends EventTarget{constructor(t,s,r){super();this.identifier=t;this.name=s;this.type=r;this.connection="closed";this.manufacturer=null;this.onstatechange=null;this.state="disconnected";this.version=null;this.id=t}async open(){return this.connection==="open"||this.connection==="pending"?this:this.state==="disconnected"?(this.connection="pending",(await d).dispatchEvent(new Event("statechange")),this.dispatchEvent(new Event("statechange")),this):(console.log("Opening",this.id),this.type==="input"?await l.openInput(this.id):await l.openOutput(this.id),this.connection="open",(await d).dispatchEvent(new Event("statechange")),this.dispatchEvent(new Event("statechange")),this)}async close(){return this.connection==="closed"?this:(this.type==="input"?await l.closeInput(this.id):await l.closeOutput(this.id),this.connection="closed",(await d).dispatchEvent(new Event("statechange")),this.dispatchEvent(new Event("statechange")),this)}},I=class extends Event{constructor(n,t){super(n,t),this.data=t?.data}},E=class extends h{constructor(t,s){super(t,s,"input");this._onmidimessage=null;this.addEventListener("midimessage",r=>{this.onmidimessage&&this.onmidimessage(r)})}open(){return this.stopListening||(this.stopListening=g.midiMessage.listen(t=>{let[s,r]=t.payload;s===this.id&&this.dispatchEvent(new I("midimessage",{data:new Uint8Array(r)}))})),super.open()}close(){return this.stopListening?.then(t=>t()),super.close()}get onmidimessage(){return this._onmidimessage}set onmidimessage(t){this._onmidimessage=t,this.connection!=="open"&&this.open()}},f=class extends h{constructor(n,t){super(n,t,"output")}send(n){if(this.state==="disconnected")throw new Error("MIDIOutput is disconnected");(this.state==="connected"&&this.connection==="closed"?this.open():Promise.resolve()).then(()=>l.outputSend(this.id,n))}},d=new Promise((e,n)=>{let t=new m(()=>e(t));setTimeout(()=>n(new Error("Failed to initialise WebMIDI")),1e4)});navigator.requestMIDIAccess=()=>d;})();
